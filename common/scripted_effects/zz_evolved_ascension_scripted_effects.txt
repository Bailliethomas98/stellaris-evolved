# common\scripted_effects\zz_evolved_ascension_scripted_effects.txt

# Ascension situation effects
tec_ascension_situation_swap_effect = {
	optimize_memory
	# Saves the situation
	save_event_target_as = tec_prev_situation
	owner = {
		save_event_target_as = tec_target_country
		event_target:tec_target_country = {
			start_situation = {
				type = $NEW_SITUATION$
				target = event_target:tec_target_country.capital_scope
				effect = {
					save_event_target_as = new_situation
				}
			}
			event_target:new_situation = {
				# No need, situation must go smooth
				#set_situation_locked = yes
				# Sorts approachs
				[[OLD_SITUATION_APPROACH_1]
					if = {
						limit = {
							event_target:tec_prev_situation = {
								current_situation_approach = $OLD_SITUATION_APPROACH_1$
							}
						}
						set_situation_approach = $NEW_SITUATION_APPROACH_1$
					}
				]
				[[!OLD_SITUATION_APPROACH_1]]
				[[OLD_SITUATION_APPROACH_2]
					if = {
						limit = {
							event_target:tec_prev_situation = {
								current_situation_approach = $OLD_SITUATION_APPROACH_2$
							}
						}
						set_situation_approach = $NEW_SITUATION_APPROACH_2$
					}
				]
				[[!OLD_SITUATION_APPROACH_2]]
				[[OLD_SITUATION_APPROACH_3]
					if = {
						limit = {
							event_target:tec_prev_situation = {
								current_situation_approach = $OLD_SITUATION_APPROACH_3$
							}
						}
						set_situation_approach = $NEW_SITUATION_APPROACH_3$
					}
				]
				[[!OLD_SITUATION_APPROACH_3]]
				# Mimics the progress of the situation
				add_situation_progress = $NEW_PROGRESS$
			}
		}
		# Deletes former situation
		event_target:tec_prev_situation = {
			abort_situation = this
		}
	}
	[[!EXTRA_EFFECT]]
	[[EXTRA_EFFECT]
		$EXTRA_EFFECT$
	]
}

# Ascension scripted effects
# ----------------

# Utils
tec_add_shroud_cd_effect = {
	add_modifier = {
		modifier = "shroud_cooldown"
		days = 2160
		time_multiplier = value:scripted_modifier_mult|MODIFIER|shroud_delve_cooldown|
	}
}

# Note: These effects are done for emulate a complete ascension perk 
# They contain the effects, flags, etc of the perk of an ap path
# Mostly used for FEs or as a tool to fix saves
	# _x_ap_effect = just the ap/starter bonuses
	# _x_finished_effect = like if the ascension took place
 # Biology
	tec_give_gene_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}
	tec_give_gene_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
		# Traits
		set_country_flag = tec_allow_t2_biotraits
		
	}
	tec_give_gene_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
		# Traits
		set_country_flag = tec_allow_t2_biotraits
		
	}

	tec_give_bio_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_bio_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_bio_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

 # Cybernetics
	tec_give_cybernetic_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}
	tec_give_cybernetic_t1_finished_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}

	tec_give_cybernetic_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_cybernetic_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

 # Synthetics
	tec_give_synthetic_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_synthetic_t1_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

	tec_give_synthetic_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_synthetic_t2_finished_standard_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_synthetic_t2_finished_nanites_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_synthetic_t2_finished_livingmetal_effect = {
		set_country_flag = tec_advanced_ascension
	}

 # Psionics
	tec_give_psionic_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}
	tec_give_psionic_t1_finished_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}

	tec_give_psionic_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_psionic_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

 # Psychic
	tec_give_psychic_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_psychic_t1_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

	tec_give_psychic_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_psychic_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}
 # Ethereal
	tec_give_etheral_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_etheral_t1_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

	tec_give_etheral_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_etheral_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

 # Mixed
	tec_give_replicant_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_replicant_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

	tec_give_biopsionic_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_biopsionic_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
		# Path finished
		set_country_flag = tec_biopsionic_path_finished
		# Alter species
		tec_create_biopsionic_species = yes
		# TO DO create specific leader ascension trait handler
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
			}
			add_leader_traits_after_modification = yes
			remove_leader_traits_after_modification = yes
		}
		every_pool_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
			}
			add_leader_traits_after_modification = yes
			remove_leader_traits_after_modification = yes
		}
		# Flags
		set_country_flag = tec_biopsionic_assimilation
	}

	tec_give_cyberpsionic_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_cyberpsionic_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
		# Path finished
		set_country_flag = tec_cyberpsionic_path_finished
		# Alter species
		tec_create_cyberpsionic_species = yes
		# TO DO create specific leader ascension trait handler
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
			}
			add_leader_traits_after_modification = yes
			remove_leader_traits_after_modification = yes
		}
		every_pool_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
			}
			add_leader_traits_after_modification = yes
			remove_leader_traits_after_modification = yes
		}
		# Flags
		set_country_flag = tec_cyberpsionic_assimilation
		remove_country_flag = tec_cybernetic_t1_assimilation
		remove_country_flag = tec_cybernetic_t2_assimilation
		# Features
		set_country_flag = tec_u_cp_equilibrium
		set_country_flag = tec_u_cp_control
		set_country_flag = tec_u_cp_power
		set_country_flag = tec_u_cp_cyborg_traits
		set_country_flag = tec_u_cp_robot_traits
		set_country_flag = tec_cyberpsionic_buildings
		# Psionic traits
		set_country_flag = tec_announced_psionic_traits
	}

	tec_give_infinity_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}

 # Gestalt
	tec_give_machine_cyb_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}
	tec_give_machine_cyb_t1_finished_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}

	tec_give_machine_cyb_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
	tec_give_machine_cyb_t2_finished_effect = {
		set_country_flag = tec_advanced_ascension
	}

	tec_give_hive_psi_t1_ap_effect = {
		set_country_flag = tec_advanced_ascension
		# Communicates 1st step
		set_country_flag = tec_comm_1st_step
	}

	tec_give_hive_psi_t2_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}

	tec_give_hive_biopsionic_ap_effect = {
		set_country_flag = tec_advanced_ascension
	}
# /

# Species changes
	tec_create_template_species = {	# TO DO
	}
	tec_create_template_species_mod = {	# TO DO
	}
	# Given a species, create a mod with trait_cybernetic and apply to all pops, leaders
	# and armies that have the original species and the same owner as the scope object.
	# Scope: Something that has a species and an owner
	REF_create_cybernetic_species_mod = {
		optimize_memory
		species = {
			modify_species = {
				remove_trait = trait_latent_psionic
				remove_trait = trait_psionic
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = this
						namelist = this
						gender = this
						traits = {
							ideal_planet_class = this
							trait = trait_cybernetic
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
			save_event_target_as = changing_species
		}
	
		owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					is_exact_same_species = event_target:changing_species
					tec_should_leader_be_assimilated = yes
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					is_exact_same_species = event_target:changing_species
					tec_should_leader_be_assimilated = yes
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					is_exact_same_species = event_target:changing_species
					tec_should_leader_be_assimilated = yes
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	# Sampled from utopia.2501 - all the immediate except communications
	REF_create_cybernetic_species = {
		optimize_memory
		#set_country_flag = cyborg_empire
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
				}
			}
			random_owned_pop = {
				limit = { is_exact_same_species = root }
				create_cybernetic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = { is_same_species = root }
				create_cybernetic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		if = {
			limit = {
				is_hive_empire = no
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								has_trait = trait_hive_mind
							}
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								has_trait = trait_hive_mind
							}
						}
					}
					create_cybernetic_species_mod = yes
				}
			}
		}

		else_if = {
			limit = {
				is_hive_empire = yes
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							has_trait = trait_hive_mind
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
							}
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							has_trait = trait_hive_mind
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
							}
						}
					}
					create_cybernetic_species_mod = yes
				}
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
			}
			random_owned_leader = {
				limit = {
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						create_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
			}
			random_pool_leader = {
				limit = {
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						create_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						create_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					NOR = {
						has_trait = trait_cybernetic
						has_trait = trait_mechanical
						has_trait = trait_machine_unit
					}
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					create_cybernetic_species_mod = yes
					kill_pop = yes
				}
			}
		}

		every_owned_leader = {
			limit = {
				species = { has_trait = trait_cybernetic }
				NOR = {
					has_trait = leader_trait_cyborg
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_cyborg
		}

		every_pool_leader = {
			limit = {
				species = { has_trait = trait_cybernetic }
				NOR = {
					has_trait = leader_trait_cyborg
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_cyborg
		}

		# removed
			#observer_event = { id = observer.55 }
			#every_country = {
			#	limit = {
			#		is_ai = no
			#		NOT = { is_same_value = root }
			#		has_communications = root
			#		root = {
			#			is_primitive = no
			#		}
			#	}
			#	country_event = { id = utopia.2505 days = 5 }
			#}
			#if = {
			#	limit = {
			#		any_planet_within_border = {
			#			has_planet_flag = fotd_seperatist_planet@root
			#			owner = {
			#				has_country_flag = fotd_seperatist_country@root
			#			}
			#		}
			#	}
			#	country_event = { id = origin.6095 days = 5 random = 2 }
			#}
		# /
	}

# Ascension paths
 # Latent Psionic
	tec_create_latent_psionic_species_mod = {
		optimize_memory

		species = {
			save_event_target_as = changing_species
			modify_species = {
				# TO DO create inline
				remove_trait = trait_cybernetic
				remove_trait = trait_tec_superior_cybernetics_main
				remove_trait = trait_tec_cyberpsionic_main
				remove_trait = trait_latent_psionic
				remove_trait = trait_psionic
				remove_trait = trait_tec_psychic_main
				remove_trait = trait_tec_hive_psionic_entanglement
				remove_trait = trait_tec_hive_psionic_resonance
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = event_target:changing_species
						namelist = this
						gender = this
						traits = {
							trait = trait_latent_psionic
							ideal_planet_class = event_target:changing_species
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
		}

		owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	tec_create_latent_psionic_species = {
		optimize_memory
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
			}
			random_owned_pop = {
				limit = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_latent_psionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_latent_psionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		while = {
			limit = {
				any_owned_pop = {
					is_sapient = yes
					species = {
						is_robotic = no
						NOR = {
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = yes
						}
					}
				}
			}
			random_owned_pop = {
				limit = {
					is_sapient = yes
					species = {
						is_robotic = no
						NOR = {
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = yes
						}
					}
				}
				tec_create_latent_psionic_species_mod = yes
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_latent_psionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_latent_psionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						tec_create_latent_psionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					tec_has_ascension_main_trait = no
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					tec_create_latent_psionic_species_mod = yes
					kill_pop = yes
				}
			}
		}
	}
 # Psionic
	tec_create_psionic_species_mod = {
		optimize_memory
		species = {
			save_event_target_as = changing_species
			modify_species = {
				# TO DO create inline
				remove_trait = trait_cybernetic
				remove_trait = trait_tec_superior_cybernetics_main
				remove_trait = trait_tec_cyberpsionic_main
				remove_trait = trait_latent_psionic
				remove_trait = trait_psionic
				remove_trait = trait_tec_psychic_main
				remove_trait = trait_tec_hive_psionic_entanglement
				remove_trait = trait_tec_hive_psionic_resonance
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = event_target:changing_species
						namelist = this
						gender = this
						traits = {
							trait = trait_psionic
							ideal_planet_class = event_target:changing_species
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
		}

		owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	tec_create_psionic_species = {
		optimize_memory
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
			}
			random_owned_pop = {
				limit = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_psionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_psionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		if = {
			limit = {
				is_hive_empire = no
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOR = {
								has_trait = trait_hive_mind
								tec_has_ascension_main_trait = yes
							}
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOR = {
								has_trait = trait_hive_mind
								tec_has_ascension_main_trait = yes
							}
						}
					}
					tec_create_psionic_species_mod = yes
				}
			}
		}

		else_if = {
			limit = {
				is_hive_empire = yes
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOR = {
								has_trait = trait_hive_mind
								tec_has_ascension_main_trait = yes
							}
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOR = {
								has_trait = trait_hive_mind
								tec_has_ascension_main_trait = yes
							}
						}
					}
					tec_create_psionic_species_mod = yes
				}
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_psionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_psionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						tec_create_psionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					tec_has_ascension_main_trait = no
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					tec_create_psionic_species_mod = yes
					kill_pop = yes
				}
			}
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_psionic }
				NOR = {
					has_trait = leader_trait_psionic
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_psionic
		}

		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_psionic }
				NOR = {
					has_trait = leader_trait_psionic
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_psionic
		}
	}
 # Genetic perfection
	tec_create_genetic_perfection_species_mod = {
		optimize_memory
		# PRE STEPS
		if = {	# Necrophage special events
			limit = {
				owner = {
					has_origin = origin_necrophage
					has_country_flag = tec_gene_necrophage_evolved
				}
			}
			modify_species = {
				remove_trait = trait_necrophage
				add_trait = @trait_tec_necroborn
				add_traits_at_start_of_list = yes
				effect = {
					root = {
						change_dominant_species = {
							species = prev
						}
					}
				}
			}
			owner_main_species = {
				every_galaxy_species = {
					limit = {
						is_same_species = prev
						NOT = { is_same_value = prev }
						has_trait = trait_necrophage
						NOR = {
							any_country = {
								NOT = { is_same_value = root }
								owner_main_species = {
									is_same_value = prevprev
								}
							}
							any_species_pop = {
								NOT = { is_owned_by = root }
							}
						}
					}
					change_species_characteristics = {
						remove_trait = trait_necrophage
						add_trait = @trait_tec_necroborn
						add_traits_at_start_of_list = yes
					}
				}
			}
			owner = { remove_country_flag = tec_gene_necrophage_evolved }
		}
		if = {	# Elder Guidance
			limit = {
				owner = {
					has_origin = origin_syncretic_evolution
					has_country_flag = tec_gene_elder_cured
				}
			}
			modify_species = {
				remove_trait = @trait_tec_se_elder
				add_trait = @trait_tec_se_subspecies
				add_traits_at_start_of_list = yes
				effect = {
					root = {
						change_dominant_species = {
							species = prev
						}
					}
				}
			}
			owner_main_species = {
				every_galaxy_species = {
					limit = {
						is_same_species = prev
						NOT = { is_same_value = prev }
						has_trait = @trait_tec_se_elder
						NOR = {
							any_country = {
								NOT = { is_same_value = root }
								owner_main_species = {
									is_same_value = prevprev
								}
							}
							any_species_pop = {
								NOT = { is_owned_by = root }
							}
						}
					}
					change_species_characteristics = {
						remove_trait = @trait_tec_se_elder
						add_trait = @trait_tec_se_subspecies
						add_traits_at_start_of_list = yes
					}
				}
			}
			owner = { remove_country_flag = tec_gene_necrophage_evolved }
		}
		if = {	# Aquatic
			limit = {
				has_trait = trait_aquatic
			}
			species = {
				change_species_characteristics = {
					remove_trait = trait_aquatic
					add_trait = trait_tec_advanced_aquatic
				}
			}
		}
		# /
		species = {
			save_event_target_as = changing_species
			modify_species = {
				ideal_planet_class = pc_tec_gene
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = event_target:changing_species
						namelist = this
						gender = this
						traits = {
							ideal_planet_class = pc_tec_gene
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
		}

		planet.owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	tec_create_genetic_perfection_species = {
		optimize_memory
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
			}
			random_owned_pop = {
				limit = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_genetic_perfection_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_genetic_perfection_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		event_target:new_main_species = {
			rename_species = {
				prompt_country = root
				name_list = ascension_list
			}
		}

		if = {
			limit = {
				is_hive_empire = no
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							tec_is_bioservant_species = no
							NOR = {
								has_trait = trait_hive_mind
								tec_has_ascension_main_trait = yes
							}
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							tec_is_bioservant_species = no
							NOR = {
								has_trait = trait_hive_mind
								tec_has_ascension_main_trait = yes
							}
						}
					}
					tec_create_genetic_perfection_species_mod = yes
				}
			}
		}
		else_if = {
			limit = {
				is_hive_empire = yes
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							tec_is_bioservant_species = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							tec_is_bioservant_species = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_genetic_perfection_species_mod = yes
				}
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_is_bioservant_species = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_is_bioservant_species = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_genetic_perfection_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_is_bioservant_species = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_is_bioservant_species = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_genetic_perfection_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						is_robotic = no
						tec_is_bioservant_species = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						is_robotic = no
						tec_is_bioservant_species = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						tec_create_genetic_perfection_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					tec_is_bioservant_species = no
					tec_has_ascension_main_trait = no
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					tec_create_genetic_perfection_species_mod = yes
					kill_pop = yes
				}
			}
		}
	}
 # Cybernetic T1
	tec_create_cybernetic_species_mod = {
		optimize_memory
		species = {
			save_event_target_as = changing_species
			modify_species = {
				# TO DO create inline
				remove_trait = trait_latent_psionic
				remove_trait = trait_psionic
				remove_trait = trait_tec_cyberpsionic_main
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = this
						namelist = this
						gender = this
						traits = {
							ideal_planet_class = this
							trait = trait_cybernetic
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
		}

		owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	tec_create_cybernetic_species = {
		optimize_memory
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
			}
			random_owned_pop = {
				limit = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_cybernetic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_cybernetic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		if = {
			limit = {
				is_hive_empire = no
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_cybernetic_species_mod = yes
				}
			}
		}

		else_if = {
			limit = {
				is_hive_empire = yes
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_cybernetic_species_mod = yes
				}
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						tec_create_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					tec_has_ascension_main_trait = no
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					tec_create_cybernetic_species_mod = yes
					kill_pop = yes
				}
			}
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_cybernetic }
				NOR = {
					has_trait = leader_trait_cyborg
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_cyborg
		}

		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_cybernetic }
				NOR = {
					has_trait = leader_trait_cyborg
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_cyborg
		}
	}
	# Note: Overwritten vanilla effects
	create_cybernetic_species_mod = {
		tec_create_cybernetic_species_mod = yes
	}
	create_cybernetic_species = {
		tec_create_cybernetic_species = yes
	}
 # Cybernetic T2
	tec_create_advanced_cybernetic_species_mod = {
		optimize_memory
		species = {
			save_event_target_as = changing_species
			modify_species = {
				# TO DO create inline
				remove_trait = trait_latent_psionic
				remove_trait = trait_psionic
				remove_trait = trait_tec_biopsionic_main
				remove_trait = trait_cybernetic
				remove_trait = trait_tec_cyberpsionic_main
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = this
						namelist = this
						gender = this
						traits = {
							ideal_planet_class = this
							trait = trait_tec_superior_cybernetics_main
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
		}

		owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	tec_create_advanced_cybernetic_species = {
		optimize_memory
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
			}
			random_owned_pop = {
				limit = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_advanced_cybernetic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_advanced_cybernetic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		if = {
			limit = {
				is_hive_empire = no
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_advanced_cybernetic_species_mod = yes
				}
			}
		}

		else_if = {
			limit = {
				is_hive_empire = yes
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_advanced_cybernetic_species_mod = yes
				}
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_advanced_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_advanced_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						tec_create_advanced_cybernetic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					tec_has_ascension_main_trait = no
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					tec_create_advanced_cybernetic_species_mod = yes
					kill_pop = yes
				}
			}
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_tec_superior_cybernetics_main }
				NOR = {
					has_trait = leader_trait_tec_superior_cybernetics_main
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_tec_superior_cybernetics_main
		}

		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_tec_superior_cybernetics_main }
				NOR = {
					has_trait = leader_trait_tec_superior_cybernetics_main
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_tec_superior_cybernetics_main
		}
	}
	tec_create_advanced_cybernetic_species_ap = {
		optimize_memory
		modify_species = {
			species = this
			add_trait = @trait_tec_superior_cybernetics_main
			add_traits_at_start_of_list = yes
			remove_trait = trait_cybernetic
			change_scoped_species = no
			effect = {
				root = {
					every_owned_pop = {
						limit = {
							is_same_species = prevprevprev
							tec_has_stapled_trait = no
						}
						change_species = prevprev
					}

					every_owned_leader = {
						limit = {
							tec_should_leader_be_assimilated = yes
							is_same_species = prevprevprev
							tec_has_stapled_trait = no
						}
						tec_leader_cache_portrait = yes
						change_species = prevprev
						tec_leader_reset_portrait_on_assimilation_if_needed = yes
						add_leader_traits_after_modification = yes
						remove_leader_traits_after_modification = yes
					}
					every_pool_leader = {
						limit = {
							tec_should_leader_be_assimilated = yes
							is_same_species = prevprevprev
							tec_has_stapled_trait = no
						}
						tec_leader_cache_portrait = yes
						change_species = prevprev
						tec_leader_reset_portrait_on_assimilation_if_needed = yes
						add_leader_traits_after_modification = yes
						remove_leader_traits_after_modification = yes
					}

					every_owned_army = {
						limit = {
							is_same_species = prevprevprev
							species = { tec_has_stapled_trait = no }
						}
						modify_army = {
							species = prevprev
						}
					}
					every_controlled_ship = {
						limit = {
							is_ship_class = shipclass_colonizer
							species = {
								is_same_species = prevprevprev
								tec_has_stapled_trait = no
							}
						}
						change_species = prevprev
						#	change_species = event_target:new_replicant_species
					}
				}
			}
		}
	}	# Check zombies
 # Synth
	# Total, no need of a mod
	vanilla_synth_effect = {	#Event utopia.2551
		set_country_flag = synthetic_empire
		if = {
			limit = {
				has_policy_flag = robots_outlawed
			}
			set_policy = {
				policy = robot_pop_policy
				option = robot_pops_allowed
				cooldown = yes
			}
		}
		if = {
			limit = {
				OR = {
					has_policy_flag = ai_servitude
					has_policy_flag = ai_outlawed
				}
			}
			set_policy = {
				policy = artificial_intelligence_policy
				option = ai_full_rights
				cooldown = yes
			}
		}
		if = {
			limit = {
				OR = {
					is_active_resolution = "resolution_divinity_silence_the_soulless"
					is_active_resolution = "resolution_divinity_a_defined_purpose"
				}
			}
			owner = {
				set_timed_country_flag = { flag = resolution_breached_synthetic_evolution days = 3600 }
			}
		}
		give_technology = { tech = tech_bio_reactor message = no }

		create_species = {
			is_mod = yes
			name = this
			namelist = this
			plural = this
			class = "ROBOT"
			homeworld = root.species
			portrait = "default_robot"
			traits = {
				trait = "trait_mechanical"
			}

			effect = {
				if = {
					limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
					prev = {
						switch = {
							trigger = is_species_class
							HUM = { prev = { change_species_characteristics = { portrait = "sd_hum_robot" } } }
							MAM = { prev = { change_species_characteristics = { portrait = "sd_mam_robot" } } }
							REP = { prev = { change_species_characteristics = { portrait = "sd_rep_robot" } } }
							AVI = { prev = { change_species_characteristics = { portrait = "sd_avi_robot" } } }
							ART = { prev = { change_species_characteristics = { portrait = "sd_art_robot" } } }
							MOL = { prev = { change_species_characteristics = { portrait = "sd_mol_robot" } } }
							FUN = { prev = { change_species_characteristics = { portrait = "sd_fun_robot" } } }
							PLANT = { prev = { change_species_characteristics = { portrait = "sd_pla_robot" } } }
							LITHOID = { prev = { change_species_characteristics = { portrait = "lith_machine" } } }
							NECROID = { prev = { change_species_characteristics = { portrait = "nec_machine" } } }
							AQUATIC = { prev = { change_species_characteristics = { portrait = "aqu_machine" } } }
							TOX = { prev = { change_species_characteristics = { portrait = "tox_machine" } } }
						}
					}
				}
				save_event_target_as = new_robotic_species
			}
		}
		every_owned_pop = {
			limit = {
				is_being_purged = no
				species = {
					is_robotic = no
					is_livestock = no
				}
			}
			change_species = event_target:new_robotic_species
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					is_livestock = no
				}
			}
			change_species = event_target:new_robotic_species
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					is_robotic = no
					is_livestock = no
				}
				army_type = assault_army
			}
			modify_army = {
				name = random
				type = "robotic_army"
				species = event_target:new_robotic_species
			}
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					is_robotic = no
					is_livestock = no
				}
				army_type = defense_army
			}
			modify_army = {
				name = random
				type = "robotic_defense_army"
				species = event_target:new_robotic_species
			}
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				OR = {
					species = {
						is_robotic = no
						is_livestock = no
					}
					has_trait = leader_trait_synthetic
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:new_robotic_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}
		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				OR = {
					species = {
						is_robotic = no
						is_livestock = no
					}
					has_trait = leader_trait_synthetic
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:new_robotic_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}

		event_target:new_robotic_species = {
			rename_species = {
				prompt_country = root
				#If targeted country is a player they will get a popup asking for a name/plural/adjective combo.
				#Otherwise the species will get a random name from the specified name_list
				name_list = ascension_list
			}
		}
		change_dominant_species = { species = event_target:new_robotic_species }

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_synthetic
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_synthetic
		}
		every_envoy = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = {
					is_robotic = no
					is_livestock = no
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:new_robotic_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}
		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_synthetic
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_synthetic
		}
	}
	tec_create_synth_species = {
		species = {
			save_event_target_as = tec_original_species
		}
		if = {
			limit = {
				has_policy_flag = robots_outlawed
			}
			set_policy = {
				policy = robot_pop_policy
				option = robot_pops_allowed
				cooldown = yes
			}
		}
		if = {
			limit = {
				OR = {
					has_policy_flag = ai_servitude
					has_policy_flag = ai_outlawed
				}
			}
			set_policy = {
				policy = artificial_intelligence_policy
				option = ai_full_rights
				cooldown = yes
			}
		}
		if = {
			limit = {
				OR = {
					is_active_resolution = "resolution_divinity_silence_the_soulless"
					is_active_resolution = "resolution_divinity_a_defined_purpose"
				}
			}
			owner = {
				set_timed_country_flag = { flag = resolution_breached_synthetic_evolution days = 3600 }
			}
		}

		give_technology = { tech = tech_bio_reactor message = no }

		# Executes the robomorphosis
		if = {
			limit = {
				has_country_flag = tec_synth_use_robots
				any_owned_species = {
					has_species_flag = tec_synth_host_species_@root
				}
			}
			random_owned_species = {
				limit = {
					has_species_flag = tec_synth_host_species_@root
				}
				save_event_target_as = new_robotic_species
			}
		}
		else = {
			create_species = {
				# technically its applied at modification to avoid purifiers strange interactions, lets see...
				is_mod = yes
				name = this
				namelist = this
				plural = this
				class = "ROBOT"
				portrait = "default_robot"
				traits = {
					trait = "trait_mechanical"
				}

				effect = {
					if = { limit = { host_has_dlc = "Synthetic Dawn Story Pack" }
						prev = {
							switch = {
								trigger = is_species_class
								HUM = { prev = { change_species_characteristics = { portrait = "sd_hum_robot" } }}
								MAM = { prev = { change_species_characteristics = { portrait = "sd_mam_robot" } }}
								REP = { prev = { change_species_characteristics = { portrait = "sd_rep_robot" } }}
								AVI = { prev = { change_species_characteristics = { portrait = "sd_avi_robot" } }}
								ART = { prev = { change_species_characteristics = { portrait = "sd_art_robot" } }}
								MOL = { prev = { change_species_characteristics = { portrait = "sd_mol_robot" } }}
								FUN = { prev = { change_species_characteristics = { portrait = "sd_fun_robot" } }}
								PLANT = { prev = { change_species_characteristics = { portrait = "sd_pla_robot" } }}
								LITHOID = { prev = { change_species_characteristics = { portrait = "lith_machine" } }}
								NECROID = { prev = { change_species_characteristics = { portrait = "nec_machine" } }}
								AQUATIC = { prev = { change_species_characteristics = { portrait = "aqu_machine" } }}
								TOX = { prev = { change_species_characteristics = { portrait = "tox_machine" } } }
							}
						}
					}
					save_event_target_as = new_robotic_species
				}
			}
		}

		# Extra bonuses
		if = {
			limit = {
				is_lithoid_empire = no
				has_country_flag = tec_synth_slow_transition
			}
			event_target:new_robotic_species = {
				modify_species = {
					change_scoped_species = no
					add_trait = trait_tec_machine_biobrain
					effect = {
						save_event_target_as = new_robotic_species
					}
				}
			}
		}

		# Swaps existing traits into robotic traits
		# Note: initially thought just for slow development, but won't
		tec_swap_organic_traits_into_synth_traits = yes

		every_owned_pop = {
			limit = {
				is_being_purged = no
				species = {
					is_livestock = no
					is_robotic = no
				}
			}
			change_species = event_target:new_robotic_species
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_livestock = no
					is_robotic = no
				}
			}
			change_species = event_target:new_robotic_species
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					is_livestock = no
					is_robotic = no
				}
				army_type = assault_army
			}
			modify_army = {
				name = random
				type = "robotic_army"
				species = event_target:new_robotic_species
			}
		}

		every_owned_army = {
			limit = {
				exists = species
				exists = planet
				species = {
					is_livestock = no
					is_robotic = no
				}
				army_type = defense_army
			}
			modify_army = {
				name = random
				type = "robotic_defense_army"
				species = event_target:new_robotic_species
			}
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				OR = {
					species = {
						is_robotic = no
						is_livestock = no
					}
					has_trait = leader_trait_synthetic
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:new_robotic_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}

		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				OR = {
					species = {
						is_robotic = no
						is_livestock = no
					}
					has_trait = leader_trait_synthetic
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:new_robotic_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}

		event_target:new_robotic_species = {
			rename_species = {
				prompt_country = root
				name_list = ascension_list
			}
		}
		change_dominant_species = { species = event_target:new_robotic_species }

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_synthetic
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_synthetic
		}
		every_envoy = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = {
					is_livestock = no
					NOT = {
						has_trait = trait_mechanical
					}
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:new_robotic_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}
		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_mechanical }
				NOR = {
					has_trait = leader_trait_synthetic
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_synthetic
		}

	}
	tec_swap_organic_traits_into_synth_traits = {
		# Positive ones
		if = {	# Technician
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_ingenious
						has_trait = trait_cyborg_superconductive
						has_trait = trait_technical_skill
					}
				}
				event_target:new_robotic_species = {
					NOT = {
						has_trait = trait_robot_superconductive
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_superconductive
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Mining
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_industrious
						has_trait = trait_industrious_lithoid
						has_trait = trait_cyborg_power_drills
						has_trait = trait_crack_miner
					}
				}
				event_target:new_robotic_species = {
					NOT = {
						has_trait = trait_robot_power_drills
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_power_drills
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Agrarian
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_agrarian
						has_trait = trait_cyborg_harvesters
						has_trait = trait_farm_hands
					}
				}
				event_target:new_robotic_species = {
					NOT = {
						has_trait = trait_robot_harvesters
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_harvesters
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Intelligent
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_intelligent
						has_trait = trait_natural_physicists
						has_trait = trait_natural_sociologists
						has_trait = trait_natural_engineers
						has_trait = trait_enigmatic_intelligence
						has_trait = trait_enigmatic_intelligence_poor
						has_trait = trait_cyborg_logic_engines
						has_trait = trait_brainslug
						has_trait = trait_erudite
						has_trait = trait_artificial_intelligence
						has_trait = trait_elevated_synapses
						# Ascensions
						has_trait = trait_tec_gene_brain
						has_trait = trait_tec_cyborg_brain
						has_trait = trait_tec_replicant_brain
						# Origin
						has_trait = trait_tec_pu_neuroslug
					}
				}
				event_target:new_robotic_species = {
					NOT = {
						has_trait = trait_robot_logic_engines
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_logic_engines
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Unity
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_traditional
						has_trait = trait_expressed_tradition
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_tec_robot_good_unity
						has_trait = trait_robot_propaganda_machines
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_tec_robot_good_unity
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Thrifty
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_thrifty
						has_trait = trait_cyborg_trading_algorithms
						has_trait = trait_nuumismatic_administration
					}
				}
				event_target:new_robotic_species = {
					NOT = {
						has_trait = trait_robot_trading_algorithms
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_trading_algorithms
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Pop growth
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_rapid_breeders
						has_trait = trait_rapid_breeders_lithoid
						has_trait = trait_fertile
						has_trait = trait_vat_grown
						has_trait = trait_nivlac
						has_trait = trait_preplanned_growth
						has_trait = trait_incubator
						has_trait = trait_exotic_metabolism
						# Evolved
						has_trait = trait_tec_clone_origin
						has_trait = trait_tec_clone_template
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_mass_produced
						has_trait = trait_tec_robot_fractal
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_mass_produced
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Pop autoassembly
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_plantoid_budding
						has_trait = trait_lithoid_budding
						has_trait = trait_advanced_budding
						has_trait = trait_tiyanki
						has_trait = trait_clone_soldier_fertile
						has_trait = trait_clone_soldier_infertile
						has_trait = trait_clone_soldier_infertile_full_potential
						# Evolved
						has_trait = trait_tec_lithoid_sedimentary
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_mass_produced
						has_trait = trait_tec_robot_fractal
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_tec_robot_fractal
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Leaders
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_talented
						has_trait = trait_cyborg_enhanced_memory
					}
				}
				event_target:new_robotic_species = {
					NOT = {
						has_trait = trait_robot_enhanced_memory
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_enhanced_memory
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Leaders xp
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_quick_learners
						has_trait = trait_cyborg_learning_algorithms
						has_trait = trait_gene_mentorship
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_learning_algorithms
						has_trait = trait_robot_repurposed_hardware
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_learning_algorithms
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Pop management
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_docile
						has_trait = trait_cyborg_streamlined_protocols
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_high_bandwidth
						has_trait = trait_robot_streamlined_protocols
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_streamlined_protocols
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Housing
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_communal
						has_trait = trait_cyborg_double_jointed
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_double_jointed
						has_trait = trait_robot_bulky
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_double_jointed
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Amenities
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_charismatic
						has_trait = trait_crafted_smiles
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_domestic_protocols
						has_trait = trait_robot_emotion_emulators
						has_trait = trait_robot_uncanny
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_domestic_protocols
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Efficiency
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_tec_versatile
						has_trait = trait_very_strong
						has_trait = trait_robust
						has_trait = trait_cyborg_efficient_processors
						has_trait = trait_excessive_endurance
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_tec_robot_erratic
						has_trait = trait_robot_efficient_processors
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_efficient_processors
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Aquatic
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_aquatic
						has_trait = trait_tec_advanced_aquatic
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_tec_machine_aquatic
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_tec_machine_aquatic
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		# Negative ones
		if = {	# Growth
			limit = {
				event_target:tec_original_species = {
					has_trait = trait_slow_breeders
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_custom_made
						has_trait = trait_robot_mass_produced
						has_trait = trait_tec_robot_fractal
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_custom_made
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Leader xp
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_slow_learners
						has_trait = trait_cyborg_neural_limiters
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_learning_algorithms
						has_trait = trait_robot_repurposed_hardware
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_repurposed_hardware
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Pop management
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_unruly
						has_trait = trait_cyborg_high_bandwidth
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_streamlined_protocols
						has_trait = trait_robot_high_bandwidth
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_high_bandwidth
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
		if = {	# Housing
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_solitary
						has_trait = trait_cyborg_bulky
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_robot_double_jointed
						has_trait = trait_robot_bulky
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_bulky
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Amenities
			limit = {
				event_target:tec_original_species = {
					has_trait = trait_repugnant
				}
				event_target:new_robotic_species = {
					NOT = {
						has_trait = trait_robot_domestic_protocols
						has_trait = trait_robot_uncanny
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_robot_uncanny
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}

		if = {	# Efficiency
			limit = {
				event_target:tec_original_species = {
					OR = {
						has_trait = trait_tec_incompetent
					}
				}
				event_target:new_robotic_species = {
					NOR = {
						has_trait = trait_tec_robot_erratic
						has_trait = trait_robot_efficient_processors
					}
				}
			}
			modify_species = {
				species = event_target:new_robotic_species
				add_trait = trait_tec_robot_erratic
				change_scoped_species = no
				effect = { save_event_target_as = new_robotic_species }
			}
		}
	}
 # Synth T2
	tec_create_synth_nanite_species = {	# TO DO
	}
	tec_create_synth_nanite_species_mod = {	# TO DO
	}
	tec_create_synth_livingmetal_species = {	# TO DO
	}
	tec_create_synth_livingmetal_species_mod = {	# TO DO
	}
 # Replicant
	# Total, no need of a mod
	tec_create_replicant_species = {	# NUKE HABITABILITY FIX
		optimize_memory
		species = {
			save_event_target_as = tec_original_species
			modify_species = {
				species = this
				ideal_planet_class = pc_nuked
				# Trait cleanup
					# Origin traits
						remove_trait = trait_necrophage

						remove_trait = trait_clone_soldier_fertile
						remove_trait = trait_clone_soldier_infertile
						remove_trait = trait_clone_soldier_infertile_full_potential

						remove_trait = trait_tec_se_elder
					# /
					# Cyborgs
						remove_trait = trait_cybernetic
						remove_trait = @trait_tec_superior_cybernetics_main
						remove_trait = @trait_tec_cyberpsionic_main
					# /
					# Synths
						remove_trait = trait_mechanical
						remove_trait = trait_machine_unit
					# /
					# Special case
					remove_trait = trait_zombie
				# /
				effect = {
					create_species = {
						# technically its applied at modification to avoid purifiers strange interactions, lets see...
						is_mod = yes
						name = this
						namelist = this
						plural = this
						class = "REPLICANT"
						portrait = this
						can_be_modified = yes
						gender = this
						homeworld = root.capital_scope
						traits = {
							trait = @trait_tec_replicant_main
						}
						traits = this
						effect = {
							modify_species = {
								change_scoped_species = no
								remove_trait = trait_pc_nuked_preference
								effect = {
									save_event_target_as = tec_replicant_species
								}
							}
						}
					}
				}
			}
		}

		# Annoying traits fix
			if = {
				limit = {
					event_target:tec_replicant_species = {
						has_trait = trait_aquatic
					}
				}
				event_target:tec_replicant_species = {
					modify_species = {
						change_scoped_species = no
						remove_trait = trait_aquatic
						add_trait = trait_tec_advanced_aquatic
						effect = {
							save_event_target_as = tec_replicant_species
						}
					}
				}
			}
		# /

		# Saves flags
		event_target:tec_original_species = {
			save_event_target_as = tec_target_species
			set_species_flag = tec_prereplicant_species_of_@event_target:tec_replicant_species
		}

		event_target:tec_replicant_species = {
			set_species_flag = tec_replicant_species_of_@event_target:tec_target_species
		}

		every_owned_pop = {
			limit = {
				if = {
					limit = {
						owner = {
							is_hive_empire = no
						}
					}
					is_being_purged = no
					species = {
						is_livestock = no
						is_robotic = no
					}
				}
				else = {
					OR = {
						has_trait = trait_hive_mind
						NOR = {
							is_being_purged = yes
							species = {
								OR = {
									is_livestock = yes
									is_robotic = yes
								}
							}
						}
					}
				}
			}
			change_species = event_target:tec_replicant_species
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_livestock = no
					is_robotic = no
				}
			}
			change_species = event_target:tec_replicant_species
		}

		every_owned_army = {
			limit = {
				exists = planet
				species = {
					is_livestock = no
					is_robotic = no
				}
			}
			change_species = event_target:tec_replicant_species
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				tec_leader_cannot_take_species_traits = no
				NOT = {
					has_trait = leader_trait_tec_replicant_main
				}
				species = {
					is_robotic = no
					is_livestock = no
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:tec_replicant_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}

		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				tec_leader_cannot_take_species_traits = no
				species = {
					is_robotic = no
					is_livestock = no
				}
				NOT = {
					has_trait = leader_trait_tec_replicant_main
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:tec_replicant_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}

		event_target:tec_replicant_species = {
			rename_species = {
				prompt_country = root
				name_list = ascension_list
			}
		}
		change_dominant_species = { species = event_target:tec_replicant_species }

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_tec_replicant_main }
				NOR = {
					has_trait = leader_trait_tec_replicant_main
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_tec_replicant_main
			remove_trait = leader_trait_cyborg
			remove_trait = leader_trait_tec_superior_cybernetics_main
			remove_trait = leader_trait_tec_cyberpsionic_main
		}
		every_envoy = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = {
					is_livestock = no
					NOT = {
						has_trait = trait_tec_replicant_main
					}
				}
			}
			tec_leader_cache_portrait = yes
			change_species = event_target:tec_replicant_species
			tec_leader_reset_portrait_on_assimilation_if_needed = yes
		}
		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_tec_replicant_main }
				NOR = {
					has_trait = leader_trait_tec_replicant_main
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_tec_replicant_main
			remove_trait = leader_trait_cyborg
			remove_trait = leader_trait_tec_superior_cybernetics_main
			remove_trait = leader_trait_tec_cyberpsionic_main
		}
	}
 # Biopsionic
	tec_create_biopsionic_species_mod = {
		species = {
			save_event_target_as = changing_species
			modify_species = {
				# TO DO create inline
				remove_trait = trait_cybernetic
				remove_trait = trait_tec_superior_cybernetics_main
				remove_trait = trait_tec_cyberpsionic_main
				remove_trait = trait_latent_psionic
				remove_trait = trait_psionic
				remove_trait = trait_tec_psychic_main
				remove_trait = trait_tec_hive_psionic_entanglement
				remove_trait = trait_tec_hive_psionic_resonance
				# Special case
				remove_trait = trait_zombie
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = this
						namelist = this
						gender = this
						traits = {
							trait = trait_tec_biopsionic_main
							ideal_planet_class = event_target:changing_species
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
		}

		owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	tec_create_biopsionic_species = {
		optimize_memory
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
			}
			random_owned_pop = {
				limit = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_biopsionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_biopsionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		if = {
			limit = {
				is_hive_empire = no
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_biopsionic_species_mod = yes
				}
			}
		}

		else_if = {
			limit = {
				is_hive_empire = yes
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_biopsionic_species_mod = yes
				}
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_biopsionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_biopsionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						tec_create_biopsionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					tec_has_ascension_main_trait = no
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					tec_create_biopsionic_species_mod = yes
					kill_pop = yes
				}
			}
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_tec_biopsionic_main }
				NOR = {
					has_trait = leader_trait_tec_biopsionic_main
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_tec_biopsionic_main
			remove_trait = leader_trait_psionic
			remove_trait = leader_trait_tec_cyberpsionic_main
		}

		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = trait_tec_biopsionic_main }
				NOR = {
					has_trait = leader_trait_tec_biopsionic_main
				}
				tec_leader_cannot_take_species_traits = no
			}
			add_trait_no_notify = leader_trait_tec_biopsionic_main
			remove_trait = leader_trait_psionic
			remove_trait = leader_trait_tec_cyberpsionic_main
		}
	}
 # Cyberpsionic
	tec_create_cyberpsionic_species_mod = {
		optimize_memory
		species = {
			save_event_target_as = changing_species
			modify_species = {
				# TO DO create inline
				remove_trait = trait_latent_psionic
				remove_trait = trait_psionic
				remove_trait = trait_cybernetic
				remove_trait = trait_tec_superior_cybernetics_main
				remove_trait = trait_tec_biopsionic_main
				effect = {
					create_species = {
						is_mod = yes
						name = this
						plural = this
						class = this
						portrait = this
						traits = this
						can_be_modified = this
						homeworld = this
						namelist = this
						gender = this
						traits = {
							ideal_planet_class = this
							trait = trait_tec_cyberpsionic_main
						}
						effect = {
							save_event_target_as = tec_ascension_species
						}
					}
				}
			}
		}

		owner = {
			every_owned_pop = {
				limit = { is_exact_same_species = event_target:changing_species }
				change_species = event_target:tec_ascension_species
			}
			every_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_envoy = {
				limit = {
					tec_should_leader_be_assimilated = yes
					is_exact_same_species = event_target:changing_species
				}
				tec_leader_cache_portrait = yes
				change_species = event_target:tec_ascension_species
				tec_leader_reset_portrait_on_assimilation_if_needed = yes
			}
			every_owned_army = {
				limit = {
					exists = species
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
			every_controlled_ship = {
				limit = {
					is_ship_class = shipclass_colonizer
					is_exact_same_species = event_target:changing_species
				}
				change_species = event_target:tec_ascension_species
			}
		}
	}
	tec_create_cyberpsionic_species = {
		optimize_memory
		if = {
			limit = {
				any_owned_pop = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
			}
			random_owned_pop = {
				limit = {
					is_exact_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_cyberpsionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = root
					tec_has_stapled_trait = no
				}
				tec_create_cyberpsionic_species_mod = yes
				species = { save_event_target_as = new_main_species }
			}
		}
		change_dominant_species = { species = event_target:new_main_species }

		if = {
			limit = {
				is_hive_empire = no
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							NOT = {
								has_trait = trait_hive_mind
							}
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_cyberpsionic_species_mod = yes
				}
			}
		}

		else_if = {
			limit = {
				is_hive_empire = yes
			}
			while = {
				limit = {
					any_owned_pop = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
				}
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							is_robotic = no
							has_trait = trait_hive_mind
							tec_has_ascension_main_trait = no
						}
					}
					tec_create_cyberpsionic_species_mod = yes
				}
			}
		}

		while = {
			limit = {
				any_owned_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_cyberpsionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_pool_leader = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_pool_leader = {
				limit = {
					tec_should_leader_be_assimilated = yes
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev
					}
					last_created_pop = {
						tec_create_cyberpsionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						is_robotic = no
						tec_has_ascension_main_trait = no
					}
				}
				root.capital_scope = { #workaround to prevent main species from accidentally flipping
					create_pop = {
						species = prev.species
					}
					last_created_pop = {
						tec_create_cyberpsionic_species_mod = yes
						kill_pop = yes
					}
				}
			}
		}

		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
					is_robotic = no
					tec_has_ascension_main_trait = no
				}
			}
			root.capital_scope = { #workaround to prevent main species from accidentally flipping
				create_pop = {
					species = prev
				}
				last_created_pop = {
					tec_create_cyberpsionic_species_mod = yes
					kill_pop = yes
				}
			}
		}

		every_owned_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = @trait_tec_cyberpsionic_main }
				NOR = {
					has_trait = leader_trait_tec_cyberpsionic_main
				}
			}
			add_trait = leader_trait_tec_cyberpsionic_main
			remove_trait = leader_trait_cyborg
			remove_trait = leader_trait_tec_superior_cybernetics_main
			remove_trait = leader_trait_psionic
			remove_trait = leader_trait_tec_biopsionic_main
		}

		every_pool_leader = {
			limit = {
				tec_should_leader_be_assimilated = yes
				species = { has_trait = @trait_tec_cyberpsionic_main }
				NOR = {
					has_trait = leader_trait_tec_cyberpsionic_main
				}
			}
			add_trait = leader_trait_tec_cyberpsionic_main
			remove_trait = leader_trait_cyborg
			remove_trait = leader_trait_tec_superior_cybernetics_main
			remove_trait = leader_trait_psionic
			remove_trait = leader_trait_tec_biopsionic_main
		}
	}
 # Bioware
	tec_create_bioware_species_mod = {	# TO DO
	}
	tec_create_bioware_species = {	# TO DO
	}
 # Biogenic
	tec_create_biogenic_species_mod = {	# TO DO
	}
	tec_create_biogenic_species = {	# TO DO
	}
 # Psychic
	tec_create_psychic_species_mod = {	# TO DO
	}
	tec_create_psychic_species = {	# TO DO
	}
# /

# Sub-effects
	tec_create_psionic_body_species = {
		every_owned_pop = {
			limit = {
				is_same_species = root
				tec_is_any_psionic_species = yes
			}
			species = {
				save_event_target_as = psionic_species
			}
			modify_species = {
				species = this
				add_trait = @trait_tec_psionic_body
			}
			if = {
				limit = {
					has_trait = trait_adaptive
				}
				modify_species = {
					species = this
					remove_trait = trait_adaptive
				}
			}
			if = {
				limit = {
					has_trait = trait_adaptive_lithoid
				}
				modify_species = {
					species = this
					remove_trait = trait_adaptive_lithoid
				}
			}
			if = {
				limit = {
					has_trait = trait_extremely_adaptive
				}
				modify_species = {
					species = this
					remove_trait = trait_extremely_adaptive
				}
			}
		}
		change_dominant_species = { species = event_target:psionic_species change_all = yes }
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
				is_same_species = root
			}
			add_leader_traits_after_modification = yes
		}
	}

	tec_create_psionic_mind_species = {
		every_owned_pop = {
			limit = {
				is_same_species = root
				tec_is_any_psionic_species = yes
			}
			species = {
				save_event_target_as = psionic_species
			}
			modify_species = {
				species = this
				add_trait = @trait_tec_psionic_mind
			}
			if = {
				limit = {
					has_trait = trait_tec_dumb
				}
				modify_species = {
					species = this
					remove_trait = trait_tec_dumb
				}
			}
			if = {
				limit = {
					has_trait = trait_intelligent
				}
				modify_species = {
					species = this
					remove_trait = trait_intelligent
				}
			}
				#if = {
				#	limit = {
				#		has_trait = trait_erudite
				#	}
				#	modify_species = {
				#		species = this
				#		remove_trait = trait_erudite
				#	}
				#}
			if = {
				limit = {
					has_trait = @trait_tec_gene_brain
				}
				modify_species = {
					species = this
					remove_trait = @trait_tec_gene_brain
				}
			}
			if = {
				limit = {
					has_trait = @trait_tec_replicant_brain
				}
				modify_species = {
					species = this
					remove_trait = @trait_tec_replicant_brain
				}
			}
			if = {
				limit = {
					has_trait = @trait_tec_cyborg_brain
				}
				modify_species = {
					species = this
					remove_trait = @trait_tec_cyborg_brain
				}
			}
		}
		change_dominant_species = { species = event_target:psionic_species change_all = yes }
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
				is_same_species = root
			}
			add_leader_traits_after_modification = yes
		}
	}

	tec_create_psionic_energy_species= {
		every_owned_pop = {
			limit = {
				is_same_species = root
				tec_is_any_psionic_species = yes
			}
			species = {
				save_event_target_as = psionic_species
			}
			modify_species = {
				species = this
				add_trait = @trait_tec_psionic_energy
			}
			if = {
				limit = {
					has_trait = @trait_tec_cyborg_specialist
				}
				modify_species = {
					species = this
					remove_trait = @trait_tec_cyborg_specialist
				}
			}
		}
		change_dominant_species = { species = event_target:psionic_species change_all = yes }
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
				is_same_species = root
			}
			add_leader_traits_after_modification = yes
		}
	}

	tec_create_psionic_unity_species= {
		every_owned_pop = {
			limit = {
				is_same_species = root
				tec_is_any_psionic_species = yes
			}
			species = {
				save_event_target_as = psionic_species
			}
			modify_species = {
				species = this
				add_trait = @trait_tec_psionic_unity
			}
			if = {
				limit = {
					has_trait = trait_quarrelsome
				}
				modify_species = {
					species = this
					remove_trait = trait_quarrelsome
				}
			}
			if = {
				limit = {
					has_trait = trait_traditional
				}
				modify_species = {
					species = this
					remove_trait = trait_traditional
				}
			}
			if = {
				limit = {
					has_trait = @trait_tec_cyborg_intralink
				}
				modify_species = {
					species = this
					remove_trait = @trait_tec_cyborg_intralink
				}
			}
		}
		change_dominant_species = { species = event_target:psionic_species change_all = yes }
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
				is_same_species = root
			}
			add_leader_traits_after_modification = yes
		}
	}

	tec_create_psionic_telekinesis_species= {
		every_owned_pop = {
			limit = {
				is_same_species = root
				tec_is_any_psionic_species = yes
			}
			species = {
				save_event_target_as = psionic_species
			}
			modify_species = {
				species = this
				add_trait = @trait_tec_psionic_telekinesis
			}
			if = {
				limit = {
					has_trait = @trait_tec_cyborg_worker
				}
				modify_species = {
					species = this
					remove_trait = @trait_tec_cyborg_worker
				}
			}
		}
		change_dominant_species = { species = event_target:psionic_species change_all = yes }
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
				is_same_species = root
			}
			add_leader_traits_after_modification = yes
		}
	}

	tec_create_psionic_teleport_species= {
		every_owned_pop = {
			limit = {
				is_same_species = root
				tec_is_any_psionic_species = yes
			}
			species = {
				save_event_target_as = psionic_species
			}
			modify_species = {
				species = this
				add_trait = @trait_tec_psionic_teleport
			}
			if = {
				limit = {
					has_trait = trait_sedentary
				}
				modify_species = {
					species = this
					remove_trait = trait_sedentary
				}
			}
			if = {
				limit = {
					has_trait = trait_nomadic
				}
				modify_species = {
					species = this
					remove_trait = trait_nomadic
				}
			}
		}
		change_dominant_species = { species = event_target:psionic_species change_all = yes }
		every_owned_leader = {
			limit = {
				tec_leader_cannot_take_species_traits = no
				is_same_species = root
			}
			add_leader_traits_after_modification = yes
		}
	}

 # Synthetic dermis and nanite form fun
	tec_machine_organic_camouflage = {
		optimize_memory
		if = {
			limit = {
				root = {
					species_portrait = sd_hum_robot
				}
			}
			if = {
				limit = {
					NOT = {
						root = {
								is_human_species = yes
							}
						}
					}
				modify_species = {
					portrait = human
				}
			}
			else = {
				modify_species = {
					portrait = human
				}
			}
		}

		if = {
			limit = {
				root = {
					species_portrait = sd_mam_robot
				}
			}
			if = {
				limit = {
					NOT = {
						root = {
							species_portrait = mam1
							}
						}
					}
				modify_species = {
					portrait = mam1
				}
			}
			else = {
				modify_species = {
					portrait = mam1
				}
			}
		}

		if = {
			limit = {
				root = {
					species_portrait = sd_rep_robot
				}
			}
			if = {
				limit = {
					NOT = {
						root = {
							species_portrait = rep1
							}
						}
					}
				modify_species = {
					portrait = rep1
				}
			}
			else = {
				modify_species = {
					portrait = rep1
				}
			}
		}

		else = {
			modify_species = {
				portrait = nec1
			}
		}
		
	}

 # -	SPECIAL TRAIT MECHANICS - 
	tec_pure_brain_leader_effect = {
		optimize_memory
		# 200	475		825		1250	1750	2325	2975	3700	4500
		if = {
			limit = {
				from = {
					has_level = 2
				}
			}
			add_experience = 200
		}
		else_if = {
			limit = {
				from = {
					has_level = 3
				}
			}
			add_experience = 475
		}
		else_if = {
			limit = {
				from = {
					has_level = 4
				}
			}
			add_experience = 825
		}
		else_if = {
			limit = {
				from = {
					has_level = 5
				}
			}
			add_experience = 1250
		}
		else_if = {
			limit = {
				from = {
					has_level = 6
				}
			}
			add_experience = 1750
		}
		else_if = {
			limit = {
				from = {
					has_level = 7
				}
			}
			add_experience = 2325
		}
		else_if = {
			limit = {
				from = {
					has_level = 8
				}
			}
			add_experience = 2975
		}
		else_if = {
			limit = {
				from = {
					has_level = 9
				}
			}
			add_experience = 3700
		}
		else_if = {
			limit = {
				from = {
					has_level = 10
				}
			}
			add_experience = 4500
		}

	}
# /


# Note: Temp remove trait effects for each block
	#	# Cybernetic block
	#		remove_trait = trait_cybernetic
	#			remove_trait = trait_cyborg_power_drills
	#			remove_trait = trait_cyborg_harvesters
	#			remove_trait = trait_cyborg_superconductive
	#			remove_trait = trait_cyborg_efficient_processors
	#			remove_trait = trait_cyborg_logic_engines
	#			remove_trait = trait_cyborg_loyalty_circuits
	#			remove_trait = trait_cyborg_double_jointed
	#			remove_trait = trait_cyborg_bulky
	#			remove_trait = trait_cyborg_enhanced_memory
	#			remove_trait = trait_cyborg_durable
	#			remove_trait = trait_cyborg_high_maintenance
	#			remove_trait = trait_cyborg_learning_algorithms
	#			remove_trait = trait_cyborg_power_intensive
	#			remove_trait = trait_cyborg_neural_limiters
	#			remove_trait = trait_cyborg_streamlined_protocols
	#			remove_trait = trait_cyborg_high_bandwidth
	#			remove_trait = trait_cyborg_trading_algorithms
	#	# /
	#	# Adv Cyb block
	#		remove_trait = trait_tec_superior_cybernetics_main
	#			remove_trait = trait_tec_cyborg_bioimplants
	#			remove_trait = trait_tec_cyborg_brain
	#			remove_trait = trait_tec_cyborg_databank
	#			remove_trait = trait_tec_cyborg_endo
	#			remove_trait = trait_tec_cyborg_endo_2
	#			remove_trait = trait_tec_cyborg_extralimbs
	#			remove_trait = trait_tec_cyborg_fashion
	#			remove_trait = trait_tec_cyborg_intralink
	#			remove_trait = trait_tec_cyborg_mecha
	#			remove_trait = trait_tec_cyborg_mindless
	#			remove_trait = trait_tec_cyborg_selfmaintenance
	#			remove_trait = trait_tec_cyborg_specialist
	#			remove_trait = trait_tec_cyborg_worker
	#	# /
	#	# Cyberpsionic block
	#		remove_trait = trait_tec_cyberpsionic_main
	#			remove_trait = trait_tec_cyberpsionic_amplifier
	#			remove_trait = trait_tec_cyberpsionic_control
	#			remove_trait = trait_tec_cyberpsionic_endoskeleton
	#			remove_trait = trait_tec_cyberpsionic_equilibrium
	#			remove_trait = trait_tec_cyberpsionic_infusion
	#			remove_trait = trait_tec_cyberpsionic_power
	#	# /
# /